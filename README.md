# AVR-PX4-Firmware

[![Build PX4/Pymavlink](https://github.com/nathanvaughn/AVR-PX4-Firmware/actions/workflows/build.yml/badge.svg)](https://github.com/nathanvaughn/AVR-PX4-Firmware/actions/workflows/build.yml)

This repository produces builds of [PX4](https://px4.io/) with the patches
required for Bell AVR HIL GPS, along with modified versions of
[Pymavlink](https://github.com/ardupilot/pymavlink).

## Usage

**This repository needs to be used inside of a DevContainer.**

When using VS Code, accept the "Clone in Volume" Devcontainer prompt.
For Windows users, this will significantly improve disk I/O and compile times.

![](images/devcontainer-prompt.png)

Additionally, you can also select the same command from the command palette:

![](images/devcontainer-command.png)

Once inside the Devcontainer, you can now run the build script. All files
generated by the build script will go into `dist/`.

To build a specific PX4 target:

```bash
vtr build-px4 --targets px4_fmu-v6x_default
```

More than one PX4 target can be provided at a time. If none are provided,
all 3 major PX4 architectures will be built.

To build a pymavlink package:

```bash
vtr build-pymavlink
```

To build a Wireshark Lua plugin:

```bash
vtr build-wireshark
```

## Files

- `.px4-version`: PX4 version to build against, in the style of `.python-version` or `.node-version`.
- `AVR.params`: PX4 parameters to unconditionally trust the HIL GPS.
- `bell.xml`: New MAVLink message definition.
- `patches/`: PX4 and pymavlink patches to monkey patch the code.
